\documentclass{article}
\usepackage[a4paper, total={6in, 10in}]{geometry}
\usepackage{amsmath}
\usepackage{listings}

\newcommand{\documentTitle}{Information Retrieval Project 2023-2024}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    % backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=mystyle}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
    pdftitle={\documentTitle},
    pdfpagemode=FullScreen,
    }

\title{\textbf{\documentTitle}}
\author{Sander Marinus - s0205151\\Maarten Peirsman - s0207151}

\begin{document}
\maketitle

\section{Problem Definition}
We made a search engine that allows users to search through over $500.000$
recipes and close to $1.500.000$ reviews, using different parameters, as
inspired by \href{https://supercook.com}{supercook.com}.
The available parameters are $Included\ Ingredients$,
$Excluded\ Ingredients$, $Name$, $Rating$ and $Duration$.\\~\\
The purpose of this search engine is to allow users to specify which
ingredients they already have, and present them with possible recipes this
would allow them to make.
We wanted to allow the user to search for parts of the ingredients of the recipe.
This allows us to make suggestions based on recipes for which the user has all
ingredients already or suggest recipes for which some extra items are needed.
% TODO: klopt dit in onze tests?
\\~\\
Next, we wanted to extend on the functionalities present in supercook, by
allowing the user the specify a range for both rating and duration.
The rating range allows the user to set a lower bound for the ratings the
returned recipes can have. For example: setting range to 3 will ensure our
system only returns recipes with a rating of 3 of higher.
The opposite goes for the duration. The duration allows you to specify a maximum
duration. As a consequence, the returned recipes will only have a duration that is
smaller than the maximum duration specified.

\section{System, algorithms and covered topics}
\subsection{System}
We have built a web server that acts as an api endpoint to facilitate
the recipe searching. This api can handle a request taking in which
ingredients you have at your disposal.
It also allows you to specify certain ingredients you wish to exclude.
This would benefit users that have certain allergies, in that they could
rule out certain recipes without having to look through them first.
% TODO: continue

\subsection{Algorithms}
Our solution makes use of the Apache Lucene project. This is an open-source
search software that implements most of the widely used Information Retrieval
algorithms. One of the algorithms used is the BestMatch25 algorithm.
\subsubsection{BestMatch25}
The BestMatch25 is a probabilistic model that aims to improve on the basic
Binary Independence Model (BIM). It does this by first using a simple scoring
for the query terms in the document.
$$RSV_d=\displaystyle\sum_{t\in q}\log \frac{N}{df_t}$$
Next it improves upon this simple scoring by taking into account the term
frequency and document length.
$$RSV_d=\displaystyle\sum_{t\in q}\log \left(\frac{N}{df_t}\right) \frac{(k_1 + 1) tf_{td}}{k_1((1 - b) + b \cdot (L_d/L_{ave}))+tf_{td}}$$
Where \begin{itemize}
    \item $tf_{td}$: term frequency in document $d$
    \item $L_d\ (L_{ave})$: length of document $d$ (average document length in the whole collection)
    \item $k_1$: tuning parameter controlling the document term frequency scaling
    \item $b$: tuning paramter controlling the scaling by document length
\end{itemize}
\small
\textit{Adapted from the lecture slides}\\~\\
\normalsize
% TODO: is this still the case?
The default BM25Similarity implementation in lucene uses $k_1 = 1.2$ and $b=0.75$.
We tested this to have different values for $b$ to try and better hold into account
the amount of matched ingredients compared to the total amount of ingredients.
This is because we wanted the program to rank recipes for which all ingredients are
given by the user higher than recipes for which some ingredients are missing.
\\~\\
We also experimented with using lucene's \texttt{Vector Space Model} algorithm.
\subsubsection{VSM in Lucene}
$$score(q,d) = \text{coord}(q,d) \cdot \text{queryNorm}(q) \displaystyle \sum_{t\in q}\left(tf_{td} \cdot idf_t^2 \cdot boost_t \cdot \text{norm}(t,d)\right)$$
Where \begin{itemize}
    \item coord: the number of terms of the query found in the document
    \item queryNorm: to compare across queries
    \item $tf$: default normalization of term frequency with square root
    \item $boost$: user specified boost for terms
    \item norm: normalization
\end{itemize}
\small
\textit{Adapted from the lecture slides}\\~\\
\normalsize

\subsection{Topics seen in class}
\begin{itemize}
    \item Edit distance for spelling correction
    \item Boolean search
    \item Ranked Retrieval
    \item Inverted index % TODO: remove?
    \item Okapi BM25 model
    \item Vector Space Model in Lucene
\end{itemize}

\section{Implementation details}
For ease of use on different systems, we decided to build our project
using a docker image. We are using an underlying search library called lucene,
that was written in Java and thus requires some setup to work properly with
python. This setup is facilitated by using the docker image,
in combination with docker compose.
To get the project to work with python, we used a python binding of the Java lucene
library to allow python developers to access the features of lucene in python.
\\~\\
We also briefly experimented with a python wrapper for the pylucene project, named lupyne.
However, we quickly noticed that this would limit the functionality of lucene
that we could use, so we decided to scrap lupyne and use pylucene.


\section{Evaluation criteria to evaluate performance}

\section{Quantitative results from the evaluation}

\section{Limitations}
\subsection{Ingredient autocompletion}
There is no autocompletion to add ingredients. However, be chose the more
"Information Retrieval" way of handling this by allowing spelling mistakes.
The searcher circumvents this, both by using stemming and levenshtein distance.
\subsection{Duration range}
Currently our system does not allow users to specify a range for the duration,
in the sense that they can currenlty only set a maximum duration.
It is possible with the current setup to allow for users to specify a range of
in which the duration must fall, let's say between 30 mins and 1hr. However,
we figured this would not be a common use case.

\section{References}
\begin{itemize}
    \item Information Retrieval Course Notes
    \item \url{https://lucene.apache.org/core/2_9_4/queryparsersyntax.html}
    \item \url{https://lucene.apache.org/pylucene/features.html}
    \item \url{https://www.kaggle.com/datasets/irkaal/foodcom-recipes-and-reviews?resource=download}
    \item \url{https://hub.docker.com/r/coady/pylucene}
    \item \url{https://vitejs.dev/guide/}
    \item \url{https://tailwindcss.com/docs/guides/vite#vue}
    \item \url{https://www.supercook.com/#/desktop}
    \item \url{https://nlp.stanford.edu/IR-book/html/htmledition/queries-as-vectors-1.html}
    \item \url{https://en.wikipedia.org/wiki/Tf%E2%80%93idf}
    \item \url{https://nlp.stanford.edu/IR-book/pdf/08eval.pdf}
    \item \url{https://stackoverflow.com/a/55477743}
    \item \url{https://coady.github.io/lupyne/examples/}
    \item \url{https://lucene.apache.org/core/9_9_1/core/index.html}
    \item \url{https://www.baeldung.com/lucene-analyzers}
    \item \url{https://lucene.apache.org/core/7_0_1/core/org/apache/lucene/analysis/package-summary.html}
    \item \url{https://stackoverflow.com/questions/64714307/how-to-use-queryparser-for-lucene-range-queries-intpoint-longpoint}
    \item \url{https://pandas.pydata.org/docs/user_guide/merging.html}
    \item \url{https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch}
    \item \url{https://stackoverflow.com/questions/1322732/convert-seconds-to-hh-mm-ss-with-javascript}
    \item \url{https://arrow.apache.org/docs/python/generated/pyarrow.parquet.read_table.html}
\end{itemize}

\end{document}